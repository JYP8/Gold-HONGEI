<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Savings Pro - ‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ & ‡πÄ‡∏û‡∏ä‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-4 pb-10">
    <div class="max-w-md mx-auto">
        <div class="bg-gradient-to-br from-amber-500 to-yellow-600 text-white p-8 rounded-[2.5rem] shadow-2xl mb-6 text-center relative overflow-hidden">
            <h1 class="text-[10px] font-bold opacity-80 uppercase tracking-widest">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Z4)</h1>
            <p id="livePrice" class="text-5xl font-black my-2">--Loading--</p>
            <div class="inline-flex items-center gap-2 bg-black/20 px-4 py-1 rounded-full text-[10px]">
                <span id="dot" class="h-2 w-2 rounded-full bg-red-500 animate-pulse"></span>
                <span id="updateTime">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
            </div>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl mb-6 text-center border border-gray-100">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-slate-800 uppercase text-xs tracking-wider">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏™‡∏°</h3>
                <button onclick="editGoal()" class="text-[10px] bg-amber-50 px-3 py-1.5 rounded-full font-bold text-amber-600 hover:bg-amber-100 transition-all">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
            </div>
            
            <div class="relative h-44 mb-2">
                <canvas id="goalChart"></canvas>
                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="padding-top: 30px;">
                    <span id="goalPercent" class="text-4xl font-black text-slate-800">0%</span>
                    <p id="goalLabel" class="text-[10px] text-slate-400 font-bold uppercase mt-1">0 / 10 ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á</p>
                </div>
            </div>
            <p id="badgeMsg" class="text-[11px] font-bold text-amber-600 italic">"‡∏Å‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠"</p>
        </div>

        <div class="flex gap-2 mb-6 bg-white p-1.5 rounded-2xl shadow-sm">
            <button onclick="switchPort('‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ')" id="btnH" class="flex-1 py-3.5 rounded-xl font-black transition-all">‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ</button>
            <button onclick="switchPort('‡πÄ‡∏û‡∏ä‡∏£')" id="btnP" class="flex-1 py-3.5 rounded-xl font-black transition-all">‡πÄ‡∏û‡∏ä‡∏£</button>
        </div>

        <div class="grid grid-cols-1 gap-3 mb-6">
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border-b-4 border-amber-400 text-center">
                <p class="text-[10px] text-amber-600 font-bold uppercase mb-1 tracking-widest">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                <p id="currentValue" class="text-3xl font-black text-slate-800">‡∏ø0</p>
                <p class="text-[10px] text-slate-400">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border-b-4 border-slate-100 text-center">
                    <p class="text-[9px] text-gray-400 font-bold uppercase mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ</p>
                    <p id="totalCost" class="text-lg font-black text-slate-700">‡∏ø0</p>
                </div>
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border-b-4 border-slate-100 text-center">
                    <p class="text-[9px] text-gray-400 font-bold uppercase mb-1">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏≥‡πÑ‡∏£</p>
                    <p id="totalProfit" class="text-lg font-black">‡∏ø0</p>
                </div>
            </div>
        </div>

        <div class="bg-slate-900 p-6 rounded-[2.5rem] shadow-2xl mb-8">
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="relative">
                    <label class="text-[9px] text-amber-500 font-bold ml-2 uppercase">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label>
                    <input type="number" id="inAmt" placeholder="0.00" class="w-full p-3 bg-slate-800 text-white rounded-xl outline-none border-none font-bold">
                </div>
                <div class="relative">
                    <label class="text-[9px] text-amber-500 font-bold ml-2 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á (‡∏ø)</label>
                    <input type="number" id="inRate" placeholder="0.00" class="w-full p-3 bg-slate-800 text-white rounded-xl outline-none border-none font-bold">
                </div>
            </div>
            <button onclick="saveToCloud()" id="saveBtn" class="w-full bg-gradient-to-r from-amber-400 to-yellow-600 text-white py-4 rounded-xl font-black shadow-lg active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏° ‚ú®</button>
        </div>

        <div class="flex items-center gap-2 mb-4 ml-2">
            <div class="h-1 w-4 bg-amber-500 rounded-full"></div>
            <h3 class="font-bold text-slate-800 text-xs uppercase tracking-widest">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h3>
        </div>
        <div id="historyLogs" class="space-y-3"></div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxwfd28g9moTu-lKzIoKtFKysRiD2Id4LchPnQj4fQFRR1Dahh3ED8CseyItgKGCH6b/exec';
        
        let currentPort = '‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ';
        let marketPrice = 0;
        let myChart;

        async function syncData() {
            try {
                const res = await fetch(scriptURL);
                const result = await res.json();
                
                if (result.price) {
                    marketPrice = result.price;
                    document.getElementById('livePrice').innerText = `‡∏ø${marketPrice.toLocaleString()}`;
                    document.getElementById('updateTime').innerText = 'Sync: ' + new Date().toLocaleTimeString();
                    document.getElementById('dot').className = "h-2 w-2 rounded-full bg-green-500 animate-none";
                }
                refreshUI(result.data);
            } catch (e) {
                document.getElementById('updateTime').innerText = 'Error Connecting...';
            }
        }

        function editGoal() {
            const currentGoal = localStorage.getItem('goal_' + currentPort) || 10;
            const newGoal = prompt("‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏° (‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á):", currentGoal);
            if (newGoal && !isNaN(newGoal)) {
                localStorage.setItem('goal_' + currentPort, newGoal);
                syncData();
            }
        }

        function refreshUI(data) {
            let totalW = 0, totalCost = 0, html = '';
            
            data.slice(1).forEach(row => {
                if(row[1] === currentPort) {
                    const w = parseFloat(row[4]);
                    const cost = parseFloat(row[2]);
                    totalW += w;
                    totalCost += cost;
                    html = `
                    <div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border-l-4 border-amber-400 animate-fade-in">
                        <div>
                            <p class="font-black text-slate-800 text-sm">${w.toFixed(3)} ‡∏Å‡∏£‡∏±‡∏°</p>
                            <p class="text-[9px] text-slate-400 font-bold uppercase">${new Date(row[0]).toLocaleDateString('th-TH')}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-slate-700 text-xs text-amber-600">‡∏ø${cost.toLocaleString()}</p>
                            <p class="text-[8px] text-slate-300">Rate: ${parseFloat(row[3]).toLocaleString()}</p>
                        </div>
                    </div>` + html;
                }
            });

            const curBaht = totalW / 15.24;
            const currentVal = Math.round(curBaht * marketPrice); // ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≠‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const profit = currentVal - totalCost; // ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            const target = parseFloat(localStorage.getItem('goal_' + currentPort)) || 10;
            const progress = (curBaht / target) * 100;

            // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≠‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (New!)
            document.getElementById('currentValue').innerText = `‡∏ø${currentVal.toLocaleString()}`;

            // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°
            document.getElementById('totalCost').innerText = `‡∏ø${totalCost.toLocaleString()}`;

            // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            const profitEl = document.getElementById('totalProfit');
            const percent = totalCost > 0 ? ((profit/totalCost)*100).toFixed(1) : 0;
            profitEl.innerText = `‡∏ø${profit.toLocaleString()} (${percent}%)`;
            profitEl.className = profit >= 0 ? "text-lg font-black text-green-500" : "text-lg font-black text-red-500";

            // Update Progress UI
            document.getElementById('goalPercent').innerText = progress.toFixed(1) + '%';
            document.getElementById('goalLabel').innerText = `${curBaht.toFixed(2)} / ${target} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á`;
            document.getElementById('historyLogs').innerHTML = html || '<p class="text-center text-slate-300 text-xs italic py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</p>';
            
            updateChart(progress);
            updateBadge(progress);
            updateButtonStyles();
        }

        function updateChart(percent) {
            const ctx = document.getElementById('goalChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [percent, 100 - percent],
                        backgroundColor: ['#f59e0b', '#f1f5f9'],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: { 
                    cutout: '85%',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { tooltip: { enabled: false } } 
                }
            });
        }

        function updateBadge(p) {
            const msg = p >= 100 ? "üèÜ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏•‡∏¢" : p >= 50 ? "‚≠êÔ∏è ‡∏°‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡∏™‡∏π‡πâ‡∏ï‡πà‡∏≠!" : "üå± ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÑ‡∏õ‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î...";
            document.getElementById('badgeMsg').innerText = `"${msg}"`;
        }

        function updateButtonStyles() {
            const active = "flex-1 py-3.5 rounded-xl font-black bg-amber-500 text-white shadow-lg scale-105 transition-all";
            const inactive = "flex-1 py-3.5 rounded-xl font-black bg-white text-slate-400 transition-all";
            document.getElementById('btnH').className = currentPort === '‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ' ? active : inactive;
            document.getElementById('btnP').className = currentPort === '‡πÄ‡∏û‡∏ä‡∏£' ? active : inactive;
        }

        function switchPort(n) { currentPort = n; syncData(); }
        
        async function saveToCloud() {
            const amt = document.getElementById('inAmt').value;
            const rate = document.getElementById('inRate').value;
            if(!amt || !rate) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞");
            
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
            const weight = (parseFloat(amt) / parseFloat(rate)) * 15.24;
            
            try {
                await fetch(scriptURL, { 
                    method: 'POST', 
                    body: JSON.stringify({ port: currentPort, amount: amt, rate: rate, weight: weight }) 
                });
                document.getElementById('inAmt').value = '';
                document.getElementById('inRate').value = '';
                await syncData();
            } catch (e) { alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞"); }
            
            btn.disabled = false;
            btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏° ‚ú®";
        }

        syncData();
        setInterval(syncData, 60000);
    </script>
</body>
</html>
