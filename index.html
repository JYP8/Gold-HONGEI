<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Gold Saving Tracker</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#fafafa;
  max-width:520px;
  margin:auto;
  padding:20px;
}
h2{text-align:center}
.card{
  background:#fff;
  padding:14px;
  border-radius:12px;
  margin-top:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
input,button{
  width:100%;
  padding:10px;
  margin-top:6px;
  font-size:15px
}
button{
  background:#d4af37;
  border:none;
  border-radius:8px;
  cursor:pointer
}
.tab{display:flex;gap:6px}
.tab button{width:50%;background:#eee}
.tab .active{background:#d4af37}
.hidden{display:none}
.progress{
  background:#eee;
  height:14px;
  border-radius:10px;
  overflow:hidden
}
.progress-bar{
  background:#d4af37;
  height:100%
}
.small{font-size:13px;color:#666}
.alert{
  background:#fff3cd;
  border-left:5px solid #d4af37;
  padding:10px;
  border-radius:8px;
}
</style>
</head>

<body>

<h2>üí∞ Gold Saving Tracker</h2>

<div id="priceBox" class="card">
  <b id="priceText">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‚Ä¶</b>
  <div class="small">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏°‡∏≤‡∏Ñ‡∏°‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥</div>
</div>

<div id="manualBox" class="card hidden">
  <div class="alert">
    ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ<br>
    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó/‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á)
  </div>
  <input type="number" id="manualPrice" placeholder="‡πÄ‡∏ä‡πà‡∏ô 42000">
  <button onclick="saveManualPrice()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</button>
</div>

<div class="tab">
  <button id="tab1" class="active" onclick="switchTab(1)">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1</button>
  <button id="tab2" onclick="switchTab(2)">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 2</button>
</div>

<div id="person1"></div>
<div id="person2" class="hidden"></div>

<script>
const BAHT_TO_GRAM = 15.244;
let goldPrice = 0;

// ===== AUTO FETCH =====
async function fetchGoldPrice(){
  try{
    const res = await fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent("https://www.goldtraders.or.th/api/getprices"),
      {cache:"no-store"}
    );
    const data = await res.json();

    goldPrice = parseFloat(
      data.gold.bar.sell.replace(/,/g,"")
    );

    localStorage.setItem("latestGoldPrice", goldPrice);

    document.getElementById("priceText").innerText =
      "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: " + goldPrice.toLocaleString() + " ‡∏ö‡∏≤‡∏ó / ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á";

    updateSummary(1);
    updateSummary(2);

  }catch(e){
    fallbackPrice();
  }
}

// ===== FALLBACK =====
function fallbackPrice(){
  const saved = localStorage.getItem("latestGoldPrice");
  if(saved){
    goldPrice = parseFloat(saved);
    document.getElementById("priceText").innerText =
      "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: " + goldPrice.toLocaleString() + " ‡∏ö‡∏≤‡∏ó (‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô)";
    updateSummary(1);
    updateSummary(2);
  }else{
    document.getElementById("priceText").innerText =
      "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    document.getElementById("manualBox").classList.remove("hidden");
  }
}

function saveManualPrice(){
  const v = parseFloat(document.getElementById("manualPrice").value);
  if(!v) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  goldPrice = v;
  localStorage.setItem("latestGoldPrice", v);
  document.getElementById("manualBox").classList.add("hidden");
  document.getElementById("priceText").innerText =
    "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: " + v.toLocaleString() + " ‡∏ö‡∏≤‡∏ó";
  updateSummary(1);
  updateSummary(2);
}

// ===== UI / LOGIC =====
function switchTab(n){
  person1.classList.add("hidden");
  person2.classList.add("hidden");
  tab1.classList.remove("active");
  tab2.classList.remove("active");
  document.getElementById("person"+n).classList.remove("hidden");
  document.getElementById("tab"+n).classList.add("active");
}

function init(person){
  document.getElementById("person"+person).innerHTML=`
  <div class="card">
    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏≠‡∏£‡πå‡∏ï</label>
    <input id="name${person}">
    <label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á)</label>
    <input type="number" id="goal${person}">
    <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
    <input type="number" id="buy${person}">
    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
    <input type="number" id="amt${person}">
    <button onclick="add(${person})">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
  <div id="sum${person}" class="card"></div>
  `;
  updateSummary(person);
}

function add(p){
  const b=+buy${p}.value,a=+amt${p}.value;
  if(!b||!a) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  const bg=a/b,g=bg*BAHT_TO_GRAM;
  const k="gold"+p;
  const d=JSON.parse(localStorage.getItem(k))||[];
  d.push({a,bg,g});
  localStorage.setItem(k,JSON.stringify(d));
  updateSummary(p);
}

function updateSummary(p){
  const d=JSON.parse(localStorage.getItem("gold"+p))||[];
  let m=0,b=0,g=0;
  d.forEach(x=>{m+=x.a;b+=x.bg;g+=x.g});
  const goal=+document.getElementById("goal"+p)?.value||0;
  const val=b*goldPrice;
  const pct=goal?Math.min(b/goal*100,100):0;
  document.getElementById("sum"+p).innerHTML=`
  <b>‡∏û‡∏≠‡∏£‡πå‡∏ï:</b> ${document.getElementById("name"+p)?.value||"-"}<br>
  ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°: ${m.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
  ‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°: ${b.toFixed(4)} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á<br>
  ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${val.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
  ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${pct.toFixed(1)}%
  <div class="progress"><div class="progress-bar" style="width:${pct}%"></div></div>
  `;
}

init(1);init(2);fetchGoldPrice();
</script>

</body>
</html>
