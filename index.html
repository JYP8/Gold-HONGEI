<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Tracker - ‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ & ‡πÄ‡∏û‡∏ä‡∏£</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #fafafa; }
        .port-active { background-color: #fbbf24; color: white; box-shadow: 0 10px 15px -3px rgba(251, 191, 36, 0.4); }
        .gold-gradient { background: linear-gradient(135deg, #f59e0b 0%, #92400e 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <div class="bg-white p-6 rounded-[2rem] shadow-xl border-b-4 border-yellow-500 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-3xl font-black text-gray-800 tracking-tight">GOLD TRACKER</h1>
                <p class="text-gray-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏á <span class="text-yellow-600 font-bold">‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ & ‡πÄ‡∏û‡∏ä‡∏£</span></p>
            </div>
            <div class="text-center md:text-right bg-yellow-50 px-6 py-3 rounded-2xl border border-yellow-100">
                <div class="flex items-center justify-center md:justify-end gap-2 text-yellow-600 font-bold text-xs mb-1">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span>
                    </span>
                    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏°‡∏≤‡∏Ñ‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                </div>
                <p id="livePriceDisplay" class="text-3xl font-black text-gray-800">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                <p id="priceTime" class="text-[10px] text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
        </div>

        <div class="flex gap-4 mb-8 bg-gray-200/50 p-2 rounded-2xl">
            <button onclick="switchPort('mine')" id="tab-mine" class="flex-1 py-4 rounded-xl font-bold transition-all duration-500">‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ</button>
            <button onclick="switchPort('partner')" id="tab-partner" class="flex-1 py-4 rounded-xl font-bold transition-all duration-500 text-gray-500">‡πÄ‡∏û‡∏ä‡∏£</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="gold-gradient p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
                <div class="relative z-10">
                    <p class="opacity-80 font-light mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï</p>
                    <h2 id="dispWeight" class="text-5xl font-black mb-4">0.000 <span class="text-xl font-normal">‡∏Å‡∏£‡∏±‡∏°</span></h2>
                    <div id="profitContainer" class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20">
                        <span id="dispProfit" class="text-lg font-bold">‡∏ø0</span>
                        <span id="dispPercent" class="text-sm opacity-80">(0%)</span>
                    </div>
                </div>
                <div class="absolute right-[-20px] bottom-[-20px] text-[120px] opacity-10">‚öúÔ∏è</div>
            </div>

            <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100 flex flex-col justify-center">
                <div class="flex justify-between items-end mb-4">
                    <p class="text-gray-500 font-bold uppercase tracking-widest text-xs">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                    <p id="progressPercent" class="text-3xl font-black text-yellow-600">0%</p>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-5 mb-6 overflow-hidden border p-1">
                    <div id="progressBar" class="gold-gradient h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm">
                    <span id="goalText" class="font-bold text-gray-700">0 / 5 ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á</span>
                    <span id="daysLeftText" class="text-blue-500 animate-pulse font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-gray-50">
                <h3 class="font-bold mb-6 text-gray-800 flex items-center gap-2">
                    <span class="w-2 h-6 bg-yellow-500 rounded-full"></span>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-400 ml-2 mb-1 block">‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="inAmt" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5000" class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-yellow-400 transition border-none text-lg font-bold">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 ml-2 mb-1 block">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ç‡∏ì‡∏∞‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó‡∏•‡∏∞)</label>
                        <input type="number" id="inRate" placeholder="‡πÄ‡∏ä‡πà‡∏ô 44500" class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-yellow-400 transition border-none text-lg font-bold">
                    </div>
                    <button onclick="saveEntry()" class="w-full gold-gradient text-white py-5 rounded-2xl font-black text-xl shadow-lg hover:brightness-110 active:scale-95 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>

            <div class="lg:col-span-2 bg-white p-6 rounded-[2rem] shadow-sm border border-gray-50">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h3>
                    <button onclick="exportData()" class="text-xs text-blue-500">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
                <div id="historyList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                    </div>
            </div>
        </div>
        
        <div class="mt-8 bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-50">
            <h3 class="font-bold text-gray-700 mb-6">‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡∏∞‡∏™‡∏°</h3>
            <canvas id="goldChart" height="100"></canvas>
        </div>
    </div>

    <script>
        let currentPort = 'mine';
        let globalGoldPrice = 0;

        // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å API
        async function fetchRealTimePrice() {
            try {
                // ‡πÉ‡∏ä‡πâ Proxy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                const res = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://thai-gold-api.vercel.app/latest'));
                const json = await res.json();
                const data = JSON.parse(json.contents);
                
                // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÅ‡∏ó‡πà‡∏á (‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å)
                globalGoldPrice = parseInt(data.response.price.gold.out.replace(/,/g, ''));
                document.getElementById('livePriceDisplay').innerText = `‡∏ø${globalGoldPrice.toLocaleString()}`;
                document.getElementById('priceTime').innerText = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${data.response.date} ${data.response.update_time}`;
                refreshUI();
            } catch (e) {
                console.error("Price fetch error", e);
                // ‡∏ñ‡πâ‡∏≤ API ‡∏•‡πà‡∏° ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏µ 2026
                globalGoldPrice = 45000;
                document.getElementById('livePriceDisplay').innerText = `‡∏ø${globalGoldPrice.toLocaleString()}*`;
                document.getElementById('priceTime').innerText = "‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£ (API ‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á)";
                refreshUI();
            }
        }

        let db = JSON.parse(localStorage.getItem('goldProjectV4')) || {
            settings: {
                mine: { name: '‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ', goal: 10 },
                partner: { name: '‡πÄ‡∏û‡∏ä‡∏£', goal: 10 }
            },
            data: { mine: [], partner: [] }
        };

        function switchPort(port) {
            currentPort = port;
            document.getElementById('tab-mine').className = port === 'mine' ? 'flex-1 py-4 rounded-xl font-bold port-active' : 'flex-1 py-4 rounded-xl font-bold text-gray-500';
            document.getElementById('tab-partner').className = port === 'partner' ? 'flex-1 py-4 rounded-xl font-bold port-active' : 'flex-1 py-4 rounded-xl font-bold text-gray-500';
            refreshUI();
        }

        function saveEntry() {
            const amt = parseFloat(document.getElementById('inAmt').value);
            const rate = parseFloat(document.getElementById('inRate').value);
            if(!amt || !rate) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏ß‡∏¢‡∏à‡πâ‡∏≤");

            const weight = (amt / rate) * 15.24;
            db.data[currentPort].push({
                date: new Date().toISOString(),
                amount: amt,
                buyRate: rate,
                weight: weight
            });

            localStorage.setItem('goldProjectV4', JSON.stringify(db));
            document.getElementById('inAmt').value = '';
            document.getElementById('inRate').value = '';
            refreshUI();
        }

        function deleteEntry(idx) {
            if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) {
                db.data[currentPort].splice(idx, 1);
                localStorage.setItem('goldProjectV4', JSON.stringify(db));
                refreshUI();
            }
        }

        function refreshUI() {
            const data = db.data[currentPort];
            const config = db.settings[currentPort];
            
            let totalWeight = 0;
            let totalCost = 0;
            let listHTML = '';

            data.forEach((item, idx) => {
                totalWeight += item.weight;
                totalCost += item.amount;
                const currentVal = (item.weight / 15.24) * globalGoldPrice;
                const profit = currentVal - item.amount;

                listHTML += `
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl hover:bg-white transition-all border border-transparent hover:border-yellow-100 group">
                        <div class="flex items-center gap-4">
                            <div class="text-[10px] font-bold text-gray-400 bg-white w-8 h-8 rounded-full flex items-center justify-center shadow-sm">${idx+1}</div>
                            <div>
                                <p class="text-xs text-gray-400 font-bold">${new Date(item.date).toLocaleDateString('th-TH')}</p>
                                <p class="font-black text-gray-700">${item.weight.toFixed(3)} ‡∏Å‡∏£‡∏±‡∏° <span class="text-[10px] font-normal text-gray-400">@${item.buyRate.toLocaleString()}</span></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-black ${profit >= 0 ? 'text-green-500' : 'text-red-500'}">${profit >= 0 ? '‚ñ≤' : '‚ñº'} ‡∏ø${Math.abs(Math.round(profit)).toLocaleString()}</p>
                            <button onclick="deleteEntry(${idx})" class="text-[10px] text-red-300 opacity-0 group-hover:opacity-100 transition">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        </div>
                    </div>`;
            });

            document.getElementById('historyList').innerHTML = listHTML || '<p class="text-center py-10 text-gray-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</p>';
            document.getElementById('dispWeight').innerText = totalWeight.toFixed(3);
            
            const totalVal = (totalWeight / 15.24) * globalGoldPrice;
            const totalProfit = totalVal - totalCost;
            const totalPct = totalCost > 0 ? (totalProfit / totalCost) * 100 : 0;
            
            document.getElementById('dispProfit').innerText = (totalProfit >= 0 ? '+ ‡∏ø' : '- ‡∏ø') + Math.abs(Math.round(totalProfit)).toLocaleString();
            document.getElementById('dispPercent').innerText = `(${totalPct.toFixed(2)}%)`;
            document.getElementById('profitContainer').className = `inline-flex items-center gap-2 px-4 py-2 rounded-2xl border backdrop-blur-md ${totalProfit >= 0 ? 'bg-green-500/20 border-green-400/30' : 'bg-red-500/20 border-red-400/30'}`;

            // Progress
            const weightInBaht = totalWeight / 15.24;
            const progress = Math.min((weightInBaht / config.goal) * 100, 100);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressPercent').innerText = progress.toFixed(1) + '%';
            document.getElementById('goalText').innerText = `${weightInBaht.toFixed(2)} / ${config.goal} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á`;

            // Prediction
            if(data.length >= 2) {
                const dayDiff = (new Date(data[data.length-1].date) - new Date(data[0].date)) / 86400000;
                const gainPerDay = totalWeight / (dayDiff || 1);
                const remain = (config.goal * 15.24) - totalWeight;
                if(remain > 0) {
                    const days = Math.ceil(remain / gainPerDay);
                    document.getElementById('daysLeftText').innerText = `‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${days.toLocaleString()} ‡∏ß‡∏±‡∏ô‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
                } else {
                    document.getElementById('daysLeftText').innerText = "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! üéä";
                }
            }

            updateChart();
        }

        let chartObj;
        function updateChart() {
            const ctx = document.getElementById('goldChart').getContext('2d');
            if(chartObj) chartObj.destroy();
            
            const data = db.data[currentPort];
            let sum = 0;
            const points = data.map(d => { sum += d.weight; return sum; });
            const labels = data.map(d => new Date(d.date).toLocaleDateString('th-TH'));

            chartObj = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏° (‡∏Å‡∏£‡∏±‡∏°)',
                        data: points,
                        borderColor: '#d97706',
                        backgroundColor: 'rgba(217, 119, 6, 0.05)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#d97706'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false } } }
                }
            });
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(db)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gold-backup-${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        // Run
        fetchRealTimePrice();
        setInterval(fetchRealTimePrice, 300000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
        switchPort('mine');
    </script>
</body>
</html>
