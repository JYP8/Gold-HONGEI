<div class="bg-white p-6 rounded-[2.5rem] shadow-xl mb-6 border-t-4 border-amber-500">
    <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider italic">พอร์ตของ <span id="activeName" class="text-amber-600">หงษ์อี้</span></p>
            <h2 id="totalWeight" class="text-3xl font-black text-slate-800 my-1">0.000 กรัม</h2>
        </div>
        <div class="text-right border-l pl-4 border-gray-100">
            <p class="text-[10px] text-gray-400 font-bold uppercase">มูลค่าปัจจุบัน</p>
            <p id="profitText" class="text-xl font-black text-slate-800">฿0</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 p-4 bg-slate-50 rounded-3xl mb-6">
        <div>
            <p class="text-[9px] text-gray-400 font-bold uppercase">เงินต้นทั้งหมด</p>
            <p id="totalCost" class="text-sm font-bold text-slate-700">฿0</p>
        </div>
        <div class="text-right">
            <p class="text-[9px] text-gray-400 font-bold uppercase">กำไร / ขาดทุน</p>
            <p id="totalProfit" class="text-sm font-bold">฿0 (<span id="percentReturn">0%</span>)</p>
        </div>
    </div>
    
    <div class="space-y-2">
        <div class="flex justify-between items-end mb-1">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Saving Goal</span>
            <span id="goalPercent" class="text-amber-600 font-black text-sm">0%</span>
        </div>
        <div class="w-full bg-slate-200 h-3 rounded-full overflow-hidden shadow-inner">
            <div id="goalBar" class="bg-gradient-to-r from-yellow-400 to-amber-600 h-full transition-all duration-1000" style="width: 0%"></div>
        </div>
        <div class="flex justify-between items-center mt-2 text-[10px] text-slate-500 font-bold">
            <span id="goalLabel">0 / 10 บาททอง</span>
        </div>
    </div>
</div>

<script>
    // ส่วน JavaScript ที่ต้องแก้ในฟังก์ชัน refreshUI
    function refreshUI(data) {
        document.getElementById('activeName').innerText = currentPort;
        
        let totalW = 0;
        let totalCost = 0; // เก็บยอดเงินต้นรวม
        let html = '';

        // วนลูปคำนวณข้อมูลจาก Sheet
        for(let i=data.length-1; i>=1; i--) {
            if(data[i][1] === currentPort) {
                const rowW = parseFloat(data[i][4]);
                const rowCost = parseFloat(data[i][2]); // เงินต้นในแต่ละรอบ
                
                totalW += rowW;
                totalCost += rowCost;

                html += `
                    <div class="flex justify-between items-center p-4 bg-white rounded-2xl border-l-4 border-amber-400 shadow-sm mb-2">
                        <div>
                            <p class="font-black text-slate-700 text-sm">${rowW.toFixed(3)} กรัม</p>
                            <p class="text-[9px] text-slate-400 uppercase">${new Date(data[i][0]).toLocaleDateString('th-TH')}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-amber-600 text-xs">฿${rowCost.toLocaleString()}</p>
                        </div>
                    </div>`;
            }
        }

        // 1. แสดงน้ำหนักรวม
        document.getElementById('totalWeight').innerHTML = `${totalW.toFixed(3)} <span class="text-xs font-normal text-gray-400 tracking-normal">กรัม</span>`;
        document.getElementById('historyLogs').innerHTML = html || '<p class="text-center py-6 text-gray-300 italic text-[10px]">ยังไม่มีข้อมูลการออม</p>';
        
        // 2. แสดงเงินต้นรวม
        document.getElementById('totalCost').innerText = `฿${totalCost.toLocaleString()}`;

        // 3. คำนวณมูลค่าปัจจุบันและกำไร/ขาดทุน
        const curBaht = totalW / 15.24;
        if(marketPrice > 0) {
            const currentVal = Math.round(curBaht * marketPrice);
            const profit = currentVal - totalCost;
            const percent = totalCost > 0 ? (profit / totalCost) * 100 : 0;

            document.getElementById('profitText').innerText = `฿${currentVal.toLocaleString()}`;
            
            const profitEl = document.getElementById('totalProfit');
            if(profit >= 0) {
                profitEl.className = "text-sm font-bold text-green-600";
                profitEl.innerText = `+฿${profit.toLocaleString()} (+${percent.toFixed(2)}%)`;
            } else {
                profitEl.className = "text-sm font-bold text-red-500";
                profitEl.innerText = `-฿${Math.abs(profit).toLocaleString()} (${percent.toFixed(2)}%)`;
            }
        }

        // 4. อัปเดต Progress Bar
        const myGoal = parseFloat(localStorage.getItem('goal_'+currentPort)) || 10;
        const progress = (curBaht / myGoal) * 100;
        document.getElementById('goalBar').style.width = Math.min(progress, 100) + '%';
        document.getElementById('goalPercent').innerText = progress.toFixed(1) + '%';
        document.getElementById('goalLabel').innerText = `${curBaht.toFixed(2)} / ${myGoal} บาททอง`;
        
        // อัปเดตสีปุ่ม
        document.getElementById('btnH').className = currentPort === 'หงษ์อี้' ? 'flex-1 py-3.5 rounded-xl font-bold bg-amber-500 text-white shadow-md' : 'flex-1 py-3.5 rounded-xl font-bold text-gray-400 bg-gray-50';
        document.getElementById('btnP').className = currentPort === 'เพชร' ? 'flex-1 py-3.5 rounded-xl font-bold bg-amber-500 text-white shadow-md' : 'flex-1 py-3.5 rounded-xl font-bold text-gray-400 bg-gray-50';
    }
</script>
