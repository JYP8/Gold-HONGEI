<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Gold Saving Tracker (Auto)</title>

<style>
body{
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#fafafa;
  padding:20px;
  max-width:520px;
  margin:auto;
}
h2{text-align:center;}
input, button{
  width:100%;
  padding:10px;
  margin-top:6px;
  font-size:15px;
}
button{
  background:#d4af37;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:hover{opacity:0.9}
.card{
  background:#fff;
  padding:14px;
  border-radius:10px;
  margin-top:14px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
}
.tab{
  display:flex;
  gap:6px;
}
.tab button{
  width:50%;
  background:#eee;
}
.tab .active{
  background:#d4af37;
}
.hidden{display:none;}
.progress{
  background:#eee;
  height:14px;
  border-radius:10px;
  overflow:hidden;
}
.progress-bar{
  background:#d4af37;
  height:100%;
}
.small{font-size:13px;color:#666}
</style>
</head>

<body>

<h2>üí∞ Gold Saving Tracker</h2>

<div class="card">
  <b id="goldPriceText">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‚Ä¶</b>
  <div class="small">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏°‡∏≤‡∏Ñ‡∏°‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥</div>
</div>

<div class="tab">
  <button id="tab1" class="active" onclick="switchTab(1)">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1</button>
  <button id="tab2" onclick="switchTab(2)">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 2</button>
</div>

<div id="person1"></div>
<div id="person2" class="hidden"></div>

<script>
const BAHT_TO_GRAM = 15.244;
let goldPrice = 0;

// ===== ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ =====
async function fetchGoldPrice(){
  try{
    const res = await fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent("https://www.goldtraders.or.th/api/getprices")
    );
    const data = await res.json();

    goldPrice = parseFloat(
      data.gold.bar.sell.replace(/,/g,"")
    );

    document.getElementById("goldPriceText").innerText =
      "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: " + goldPrice.toLocaleString() + " ‡∏ö‡∏≤‡∏ó / ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á";

    updateSummary(1);
    updateSummary(2);

  }catch(e){
    document.getElementById("goldPriceText").innerText =
      "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
  }
}

// ===== UI =====
function switchTab(n){
  document.getElementById("person1").classList.add("hidden");
  document.getElementById("person2").classList.add("hidden");
  document.getElementById("tab1").classList.remove("active");
  document.getElementById("tab2").classList.remove("active");

  document.getElementById("person"+n).classList.remove("hidden");
  document.getElementById("tab"+n).classList.add("active");
}

function init(person){
  const el = document.getElementById("person"+person);
  el.innerHTML = `
  <div class="card">
    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏≠‡∏£‡πå‡∏ï</label>
    <input id="name${person}" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ">

    <label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á)</label>
    <input type="number" id="goal${person}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1">

    <hr>

    <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó/‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á)</label>
    <input type="number" id="buyPrice${person}">

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
    <input type="number" id="amount${person}">

    <button onclick="addRecord(${person})">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>

  <div id="summary${person}" class="card"></div>
  `;
  updateSummary(person);
}

// ===== Logic =====
function addRecord(person){
  const buyPrice = parseFloat(document.getElementById("buyPrice"+person).value);
  const amount = parseFloat(document.getElementById("amount"+person).value);

  if(!buyPrice || !amount){
    alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  const bahtGold = amount / buyPrice;
  const gram = bahtGold * BAHT_TO_GRAM;

  const key = "gold"+person;
  const data = JSON.parse(localStorage.getItem(key)) || [];
  data.push({amount, bahtGold, gram});
  localStorage.setItem(key, JSON.stringify(data));

  updateSummary(person);
}

function updateSummary(person){
  const data = JSON.parse(localStorage.getItem("gold"+person)) || [];

  let money = 0, baht = 0, gram = 0;
  data.forEach(d=>{
    money += d.amount;
    baht += d.bahtGold;
    gram += d.gram;
  });

  const name = document.getElementById("name"+person)?.value || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠";
  const goal = parseFloat(document.getElementById("goal"+person)?.value) || 0;

  const currentValue = goldPrice ? baht * goldPrice : 0;
  const profit = currentValue - money;

  let percent = goal ? (baht/goal)*100 : 0;
  if(percent > 100) percent = 100;

  document.getElementById("summary"+person).innerHTML = `
    <b>‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á: ${name}</b><br><br>
    ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°: ${money.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
    ‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°: ${baht.toFixed(4)} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á<br>
    ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏±‡∏°: ${gram.toFixed(4)} ‡∏Å‡∏£‡∏±‡∏°<br><br>

    ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${currentValue.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
    ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô: ${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br><br>

    ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${goal} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á<br>
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${percent.toFixed(1)}%
    <div class="progress">
      <div class="progress-bar" style="width:${percent}%"></div>
    </div>
  `;
}

// ===== start =====
init(1);
init(2);
fetchGoldPrice();
</script>

</body>
</html>
