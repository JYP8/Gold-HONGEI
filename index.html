<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Gold Saving Tracker V5</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#f6f7f9;
  margin:0;
  padding:20px;
}
h1 { text-align:center; }
.card {
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.06);
}
label { font-weight:600; }
input, button {
  width:100%;
  padding:10px;
  margin-top:6px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}
button {
  background:#c9a227;
  color:#fff;
  border:none;
  font-weight:600;
}
button:active { opacity:.8; }
small { color:#666; }
canvas { margin-top:12px; }
</style>
</head>

<body>

<h1>üíõ Gold Saving Tracker</h1>

<div class="card">
  <div id="goldPriceText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‚Ä¶</div>
  <small>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ó‡πà‡∏á (‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å)</small>
</div>

<div class="card">
  <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏≠‡∏£‡πå‡∏ï</label>
  <input id="ownerName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏á‡∏©‡πå‡∏≠‡∏µ‡πâ">

  <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ï‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó/‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á)</label>
  <input type="number" id="buyPrice">

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏° (‡∏ö‡∏≤‡∏ó)</label>
  <input type="number" id="amount">

  <button onclick="addRecord()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</button>
</div>

<div class="card">
  <b>‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏≠‡∏£‡πå‡∏ï</b><br><br>
  ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°: <span id="sumMoney">0</span> ‡∏ö‡∏≤‡∏ó<br>
  ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°: <span id="sumBaht">0</span> ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á<br>
  ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="sumValue">0</span> ‡∏ö‡∏≤‡∏ó
</div>

<div class="card">
  <b>üìà ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≠‡∏á‡∏£‡∏ß‡∏°</b>
  <canvas id="chartValue"></canvas>
</div>

<div class="card">
  <b>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°</b>
  <canvas id="chartMoney"></canvas>
</div>

<div class="card">
  <b>ü™ô ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°</b>
  <canvas id="chartBaht"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const BAHT_TO_GRAM = 15.244;
let goldPrice = 0;

function loadData() {
  return JSON.parse(localStorage.getItem("goldData") || "[]");
}
function saveData(data) {
  localStorage.setItem("goldData", JSON.stringify(data));
}

async function fetchGoldPrice() {
  try {
    const res = await fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent("https://www.goldtraders.or.th/api/getprices")
    );
    const data = await res.json();
    goldPrice = parseFloat(data.gold.bar.sell.replace(/,/g,""));
    localStorage.setItem("lastGoldPrice", goldPrice);
  } catch {
    goldPrice = parseFloat(localStorage.getItem("lastGoldPrice") || 0);
  }

  document.getElementById("goldPriceText").innerText =
    goldPrice
      ? "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: " + goldPrice.toLocaleString() + " ‡∏ö‡∏≤‡∏ó"
      : "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÑ‡∏î‡πâ";
}

function addRecord() {
  const buyPrice = +document.getElementById("buyPrice").value;
  const amount = +document.getElementById("amount").value;
  if (!buyPrice || !amount) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

  const bahtGold = amount / buyPrice;
  const data = loadData();
  data.push({
    date: new Date().toISOString(),
    amount,
    bahtGold
  });
  saveData(data);
  render();
}

let chartValue, chartMoney, chartBaht;

function render() {
  const data = loadData();
  let sumMoney = 0;
  let sumBaht = 0;

  const labels = [];
  const moneyArr = [];
  const bahtArr = [];
  const valueArr = [];

  data.forEach(d => {
    sumMoney += d.amount;
    sumBaht += d.bahtGold;
    labels.push(new Date(d.date).toLocaleDateString());
    moneyArr.push(sumMoney);
    bahtArr.push(sumBaht);
    valueArr.push(sumBaht * goldPrice);
  });

  document.getElementById("sumMoney").innerText = sumMoney.toFixed(2);
  document.getElementById("sumBaht").innerText = sumBaht.toFixed(4);
  document.getElementById("sumValue").innerText = (sumBaht * goldPrice).toFixed(2);

  const makeChart = (el, label, dataArr, color) =>
    new Chart(el, {
      type:"line",
      data:{ labels, datasets:[{ label, data:dataArr, borderColor:color, fill:false }]},
      options:{ responsive:true }
    });

  if (chartValue) chartValue.destroy();
  if (chartMoney) chartMoney.destroy();
  if (chartBaht) chartBaht.destroy();

  chartValue = makeChart(chartValueCanvas, "‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≠‡∏á", valueArr, "#c9a227");
  chartMoney = makeChart(chartMoneyCanvas, "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°", moneyArr, "#4caf50");
  chartBaht  = makeChart(chartBahtCanvas,  "‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á", bahtArr,  "#2196f3");
}

const chartValueCanvas = document.getElementById("chartValue");
const chartMoneyCanvas = document.getElementById("chartMoney");
const chartBahtCanvas  = document.getElementById("chartBaht");

fetchGoldPrice().then(render);
</script>

</body>
</html>
