<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gold Saving Tracker V4</title>

<style>
body { font-family: Arial; padding:20px; max-width:500px; margin:auto; }
input, button { padding:8px; margin:5px 0; width:100%; }
button { cursor:pointer; }
.tabbtn { width:49%; }
.hidden { display:none; }
.card { background:#f4f4f4; padding:12px; margin-top:10px; border-radius:8px; }
.progress { background:#ddd; border-radius:10px; overflow:hidden; height:18px; margin-top:5px;}
.progress-bar { background:#c9a227; height:100%; }
h2 { text-align:center; }
.goldbox { background:#fff8dc; padding:10px; border-radius:8px; margin-bottom:15px;}
</style>
</head>

<body>

<h2>Gold Saving Tracker V4</h2>

<div class="goldbox">
<label>กรอกราคาทองวันนี้ (บาท/บาททอง)</label>
<input type="number" id="goldPriceInput" placeholder="เช่น 41000">
<button onclick="setGoldPrice()">บันทึกราคา</button>
<p id="goldPriceDisplay">ยังไม่ได้ตั้งราคาทอง</p>
</div>

<button class="tabbtn" onclick="switchTab(1)">คนที่ 1</button>
<button class="tabbtn" onclick="switchTab(2)">คนที่ 2</button>

<div id="person1"></div>
<div id="person2" class="hidden"></div>

<script>
const BAHT_TO_GRAM = 15.244;
let currentGoldPrice = 0;

function setGoldPrice(){
  const price = parseFloat(document.getElementById("goldPriceInput").value);
  if(!price) return alert("กรอกราคาให้ถูกต้อง");
  currentGoldPrice = price;
  localStorage.setItem("currentGoldPrice", price);
  document.getElementById("goldPriceDisplay").innerHTML =
    "ราคาทองวันนี้: " + price.toLocaleString() + " บาท";
  updateSummary(1);
  updateSummary(2);
}

function loadGoldPrice(){
  const saved = localStorage.getItem("currentGoldPrice");
  if(saved){
    currentGoldPrice = parseFloat(saved);
    document.getElementById("goldPriceDisplay").innerHTML =
      "ราคาทองวันนี้: " + currentGoldPrice.toLocaleString() + " บาท";
  }
}

function switchTab(n){
  document.getElementById("person1").classList.add("hidden");
  document.getElementById("person2").classList.add("hidden");
  document.getElementById("person"+n).classList.remove("hidden");
}

function init(person){
  const container = document.getElementById("person"+person);

  container.innerHTML = `
  <label>ชื่อเจ้าของพอร์ต</label>
  <input id="name${person}" placeholder="เช่น หงษ์อี้">

  <label>ตั้งเป้า (บาททอง)</label>
  <input type="number" id="goal${person}" placeholder="เช่น 1">

  <h3>บันทึกการซื้อ</h3>
  <label>ราคาที่ซื้อ (บาท/บาททอง)</label>
  <input type="number" id="buyPrice${person}">

  <label>จำนวนเงินที่ซื้อ (บาท)</label>
  <input type="number" id="amount${person}">

  <button onclick="addRecord(${person})">บันทึก</button>

  <div id="summary${person}" class="card"></div>
  `;

  updateSummary(person);
}

function addRecord(person){
  const buyPrice = parseFloat(document.getElementById("buyPrice"+person).value);
  const amount = parseFloat(document.getElementById("amount"+person).value);

  if(!buyPrice || !amount) return alert("กรอกข้อมูลให้ครบ");

  const bahtGold = amount / buyPrice;
  const gramGold = bahtGold * BAHT_TO_GRAM;

  let data = JSON.parse(localStorage.getItem("gold"+person)) || [];
  data.push({buyPrice, amount, bahtGold, gramGold});
  localStorage.setItem("gold"+person, JSON.stringify(data));

  updateSummary(person);
}

function updateSummary(person){
  let data = JSON.parse(localStorage.getItem("gold"+person)) || [];
  let totalMoney = 0;
  let totalBaht = 0;
  let totalGram = 0;

  data.forEach(d=>{
    totalMoney += d.amount;
    totalBaht += d.bahtGold;
    totalGram += d.gramGold;
  });

  const name = document.getElementById("name"+person)?.value || "ยังไม่ได้ตั้งชื่อ";
  const goal = parseFloat(document.getElementById("goal"+person)?.value) || 0;

  const currentValue = totalBaht * currentGoldPrice;
  const profit = currentValue - totalMoney;

  let progressPercent = goal > 0 ? (totalBaht/goal)*100 : 0;
  if(progressPercent > 100) progressPercent = 100;

  document.getElementById("summary"+person).innerHTML = `
  <b>พอร์ตของ: ${name}</b><br><br>
  เงินสะสม: ${totalMoney.toFixed(2)} บาท<br>
  ทองสะสม: ${totalBaht.toFixed(4)} บาททอง<br>
  เทียบเป็นกรัม: ${totalGram.toFixed(4)} กรัม<br><br>

  มูลค่าปัจจุบัน: ${currentValue.toFixed(2)} บาท<br>
  กำไร/ขาดทุน: ${profit.toFixed(2)} บาท<br><br>

  เป้าหมาย: ${goal} บาททอง<br>
  สำเร็จ: ${progressPercent.toFixed(2)}%
  <div class="progress">
    <div class="progress-bar" style="width:${progressPercent}%"></div>
  </div>
  `;
}

init(1);
init(2);
loadGoldPrice();
</script>

</body>
</html>
