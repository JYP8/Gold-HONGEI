<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Together - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #fcfcfc; }
        .tab-active { background-color: #facc15; color: white; transform: scale(1.05); shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .gold-gradient { background: linear-gradient(135deg, #fde047 0%, #ca8a04 100%); }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-4xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-white p-6 rounded-3xl shadow-sm border border-yellow-50">
            <div class="text-center md:text-left">
                <h1 class="text-2xl font-bold text-gray-800">‚ú® Gold Together</h1>
                <p class="text-gray-400 text-sm">‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</p>
            </div>
            <div class="bg-yellow-50 p-3 rounded-2xl text-center min-w-[150px]">
                <p class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÇ‡∏•‡∏Å/‡πÑ‡∏ó‡∏¢</p>
                <p id="livePriceDisplay" class="text-2xl font-black text-yellow-700">‡∏ø42,500</p>
            </div>
        </div>

        <div class="bg-gray-800 text-white p-4 rounded-2xl mb-6 flex justify-around items-center shadow-inner">
            <div class="text-center border-r border-gray-600 flex-1">
                <p class="text-[10px] opacity-60">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° 2 ‡∏û‡∏≠‡∏£‡πå‡∏ï</p>
                <p id="grandWeight" class="text-lg font-bold text-yellow-400">0.00 ‡∏Å‡∏£‡∏±‡∏°</p>
            </div>
            <div class="text-center flex-1">
                <p class="text-[10px] opacity-60">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                <p id="grandValue" class="text-lg font-bold text-green-400">‡∏ø0</p>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-2 mb-6 p-1 bg-gray-100 rounded-2xl">
            <button onclick="switchPort('mine')" id="tab-mine" class="py-3 rounded-xl font-bold transition-all duration-300">‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà 1</button>
            <button onclick="switchPort('partner')" id="tab-partner" class="py-3 rounded-xl font-bold transition-all duration-300 text-gray-400">‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà 2</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="gold-gradient p-8 rounded-[2rem] text-white shadow-xl relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-1">
                        <h2 id="dispPortName" class="text-xl font-bold">‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                        <button onclick="editSettings()" class="opacity-50 hover:opacity-100 text-xs">‚úé ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    </div>
                    <p id="dispWeight" class="text-5xl font-black">0.00 <span class="text-lg font-normal">‡∏Å‡∏£‡∏±‡∏°</span></p>
                    <div id="profitBadge" class="mt-4 inline-block px-3 py-1 rounded-full bg-white/20 text-sm font-bold">
                        ‡∏ø0 (0%)
                    </div>
                </div>
                <div class="absolute -right-4 -bottom-4 opacity-10 text-8xl">üèÜ</div>
            </div>

            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm font-bold mb-3 italic">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢...</p>
                <div class="flex justify-between items-end mb-2">
                    <span id="progressPercent" class="text-3xl font-black text-gray-800">0%</span>
                    <span id="goalText" class="text-sm text-gray-400 font-bold">0 / 5 ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-4 mb-4 overflow-hidden">
                    <div id="progressBar" class="gold-gradient h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                <p id="daysLeftText" class="text-xs text-blue-500 font-semibold bg-blue-50 p-2 rounded-lg inline-block text-center w-full">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                <h3 class="font-bold mb-4 text-gray-700">‚ú® ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                <div class="space-y-4">
                    <input type="number" id="inAmt" placeholder="‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (‡∏ö‡∏≤‡∏ó)" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-yellow-400 transition">
                    <input type="number" id="inRate" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó‡∏•‡∏∞)" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-yellow-400 transition">
                    <button onclick="saveEntry()" class="w-full bg-gray-800 text-white py-4 rounded-2xl font-bold hover:bg-black shadow-lg transition active:scale-95">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 min-h-[300px]">
                    <h3 class="font-bold mb-4 text-gray-700">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
                    <div id="historyList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                        </div>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
            <h3 class="font-bold text-gray-700 mb-4">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏£‡∏≤‡∏¢‡∏û‡∏≠‡∏£‡πå‡∏ï</h3>
            <canvas id="goldChart" height="120"></canvas>
        </div>
    </div>

    <script>
        let currentPort = 'mine';
        let goldPrice = 43000; 

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage
        let db = JSON.parse(localStorage.getItem('goldTogetherDB')) || {
            settings: {
                mine: { name: '‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô', goal: 5 },
                partner: { name: '‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô', goal: 5 }
            },
            data: { mine: [], partner: [] }
        };

        function switchPort(port) {
            currentPort = port;
            document.getElementById('tab-mine').className = port === 'mine' ? 'py-3 rounded-xl font-bold tab-active' : 'py-3 rounded-xl font-bold text-gray-400';
            document.getElementById('tab-partner').className = port === 'partner' ? 'py-3 rounded-xl font-bold tab-active' : 'py-3 rounded-xl font-bold text-gray-400';
            refreshUI();
        }

        function editSettings() {
            const newName = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÉ‡∏´‡∏°‡πà:", db.settings[currentPort].name);
            const newGoal = prompt("‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á):", db.settings[currentPort].goal);
            if (newName) db.settings[currentPort].name = newName;
            if (newGoal) db.settings[currentPort].goal = parseFloat(newGoal);
            saveToDB();
            refreshUI();
        }

        function saveEntry() {
            const amt = parseFloat(document.getElementById('inAmt').value);
            const rate = parseFloat(document.getElementById('inRate').value);
            if(!amt || !rate) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏à‡πâ‡∏≤");

            const weight = (amt / rate) * 15.24;
            db.data[currentPort].push({
                date: new Date().toISOString(),
                amount: amt,
                buyRate: rate,
                weight: weight
            });

            saveToDB();
            document.getElementById('inAmt').value = '';
            document.getElementById('inRate').value = '';
            refreshUI();
        }

        function deleteEntry(index) {
            if(confirm('‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
                db.data[currentPort].splice(index, 1);
                saveToDB();
                refreshUI();
            }
        }

        function saveToDB() {
            localStorage.setItem('goldTogetherDB', JSON.stringify(db));
        }

        function refreshUI() {
            const config = db.settings[currentPort];
            const data = db.data[currentPort];
            
            document.getElementById('dispPortName').innerText = config.name;
            document.getElementById('tab-mine').innerText = db.settings.mine.name;
            document.getElementById('tab-partner').innerText = db.settings.partner.name;

            let totalWeight = 0;
            let totalCost = 0;
            let listHTML = '';

            data.forEach((item, idx) => {
                totalWeight += item.weight;
                totalCost += item.amount;
                const curVal = (item.weight / 15.24) * goldPrice;
                const diff = curVal - item.amount;
                const isPositive = diff >= 0;

                listHTML += `
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl border border-gray-100 hover:bg-white transition shadow-sm">
                        <div class="flex gap-4 items-center">
                            <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 font-bold text-xs">${idx+1}</div>
                            <div>
                                <p class="text-xs text-gray-400 font-bold uppercase">${new Date(item.date).toLocaleDateString('th-TH')}</p>
                                <p class="font-bold text-gray-700">${item.weight.toFixed(3)} ‡∏Å‡∏£‡∏±‡∏° <span class="text-[10px] text-gray-400 font-normal">(@‡∏ø${item.buyRate.toLocaleString()})</span></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-black ${isPositive ? 'text-green-500' : 'text-red-500'}">${isPositive ? '+' : ''}${Math.round(diff).toLocaleString()} ‡∏ø</p>
                            <button onclick="deleteEntry(${idx})" class="text-[10px] text-gray-300 hover:text-red-500">‡∏•‡∏ö‡∏≠‡∏≠‡∏Å</button>
                        </div>
                    </div>`;
            });

            document.getElementById('historyList').innerHTML = listHTML || '<div class="text-center py-20 text-gray-300">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</div>';
            document.getElementById('dispWeight').innerHTML = `${totalWeight.toFixed(3)} <span class="text-lg font-normal">‡∏Å‡∏£‡∏±‡∏°</span>`;
            
            // Profit Calc
            const currentTotalVal = (totalWeight / 15.24) * goldPrice;
            const totalProfit = currentTotalVal - totalCost;
            const profitPct = totalCost > 0 ? (totalProfit / totalCost) * 100 : 0;
            document.getElementById('profitBadge').innerText = `${totalProfit >= 0 ? '+' : ''}‡∏ø${Math.round(totalProfit).toLocaleString()} (${profitPct.toFixed(1)}%)`;
            document.getElementById('profitBadge').className = `mt-4 inline-block px-3 py-1 rounded-full text-sm font-bold ${totalProfit >= 0 ? 'bg-green-500/20 text-green-100' : 'bg-red-500/20 text-red-100'}`;

            // Goal
            const weightInBaht = totalWeight / 15.24;
            const progress = Math.min((weightInBaht / config.goal) * 100, 100);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressPercent').innerText = progress.toFixed(1) + '%';
            document.getElementById('goalText').innerText = `${weightInBaht.toFixed(2)} / ${config.goal} ‡∏ö‡∏≤‡∏ó‡∏ó‡∏≠‡∏á`;

            // Prediction
            if(data.length >= 2) {
                const daysDiff = (new Date(data[data.length-1].date) - new Date(data[0].date)) / (1000*60*60*24);
                const avgPerDay = totalWeight / (daysDiff || 1);
                const remaining = (config.goal * 15.24) - totalWeight;
                if(remaining > 0) {
                    const daysToGoal = Math.ceil(remaining / avgPerDay);
                    document.getElementById('daysLeftText').innerText = `üî• ‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${daysToGoal.toLocaleString()} ‡∏ß‡∏±‡∏ô ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢!`;
                } else {
                    document.getElementById('daysLeftText').innerText = `üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß`;
                }
            }

            // Grand Summary
            const totalBothWeight = (db.data.mine.reduce((s,i)=>s+i.weight,0) + db.data.partner.reduce((s,i)=>s+i.weight,0));
            const totalBothVal = (totalBothWeight / 15.24) * goldPrice;
            document.getElementById('grandWeight').innerText = totalBothWeight.toFixed(3) + ' ‡∏Å‡∏£‡∏±‡∏°';
            document.getElementById('grandValue').innerText = '‡∏ø' + Math.round(totalBothVal).toLocaleString();

            updateChart();
        }

        let chartObj;
        function updateChart() {
            const ctx = document.getElementById('goldChart').getContext('2d');
            if(chartObj) chartObj.destroy();
            const labels = db.data[currentPort].map(i => new Date(i.date).toLocaleDateString('th-TH'));
            let runT = 0;
            const pts = db.data[currentPort].map(i => { runT += i.weight; return runT; });

            chartObj = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°',
                        data: pts,
                        borderColor: '#ca8a04',
                        backgroundColor: 'rgba(202, 138, 4, 0.1)',
                        fill: true, tension: 0.3, pointRadius: 4
                    }]
                },
                options: { 
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: true }, x: { grid: { display: false } } }
                }
            });
        }

        // Initialize
        refreshUI();
    </script>
</body>
</html>
